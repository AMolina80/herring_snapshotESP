---
title: "Plots of commercial fishery indicators for atlantic herring"
author: "Adelle"
date: "2025-08-22"
output: html_document
---

```{r setup, include=FALSE}
# Set global knitr options
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
# Load libraries
library(knitr)
library(ggplot2)
library(dplyr)
library(stringr)

```

The following plots are potential commercial fishery indicators for the snapshot esp for atlantic herring

```{r load and clean}
# Make sure 'plt_herring_function.R' is in your working directory.
source(here::here("04_scripts/plt_herring_function.R"))

# Load and clean the data
herr_comm_dat <- read.csv(here::here("01_inputs/SOCIEOECONOMIC_COMMERCIAL_INDICATORS_FINAL.csv"), header = T) %>%
  dplyr::mutate(
    INDICATOR_NAME = dplyr::case_when(
      str_detect(INDICATOR_NAME, "Commercial_HERRING_Landings_LBS") ~ "Commercial_Landings",
      str_detect(INDICATOR_NAME, "TOTALANNUALREV_HERRING_2024Dols") ~ "Total_Commercial_Revenue",
      str_detect(INDICATOR_NAME, "AVGVESREVperYr_HERRING_2024_DOLlb") ~ "Vessel_Revenue_per_Year",
      str_detect(INDICATOR_NAME, "N_Commercial_Vessels_Landing_HERRING") ~ "Active_Vessels",
      str_detect(INDICATOR_NAME, "AVGPRICE_HERRING_2024_DOLlb") ~ "Price_per_Pound",
      str_detect(INDICATOR_NAME, "AVGANNUAL_DIESEL_PRICE2024dols") ~ "Fuel_Price",
      TRUE ~ INDICATOR_NAME # Keep original if no match
    )
  )

# Get the new, clean list of unique indicator names
unique_indicators_clean <- unique(herr_comm_dat$INDICATOR_NAME)
```

```{r plot and save, out.height="80%"}
# Loop through the new indicator names and display the plot
for (ind_name in unique_indicators_clean) {
  # Create a plot using the clean data. This assumes plt_herring is accessible.
  plot_path <- plt_herring(
    data = herr_comm_dat,
    ind_name = ind_name,
    img_dir = getwd(),
    years = 1989:2025,
    show_plot = T
  )
  # Display the plot with the new, simplified title
  cat(paste0("\nThe plot above shows ", ind_name, "\n\n"))
  
  # Check for millions filename as a fallback
  plot_path_millions <- here::here("05_images", paste0(ind_name, "_millions_", Sys.Date(), ".png"))

  if (file.exists(plot_path)) {
    knitr::include_graphics(plot_path)
  } else if (file.exists(plot_path_millions)) {
    knitr::include_graphics(plot_path_millions)
  } else {
    cat("Error: Plot file not found.")
  }

}
```

```{r}
short_name <- paste0(unique_indicators[2], "_",Sys.Date(), ".png")
fname <- paste(img_dir, short_name, sep = "/")
knitr::include_graphics(fname)

```

```{r }
# Loop through each indicator and display its corresponding plot
for (i in 1:6) {
  img_dir = here::here("05_images")
  short_name <- paste0(unique_indicators[i], "_",Sys.Date(), ".png")
  fname <- paste(img_dir, short_name, sep = "/")
  
# Construct an alternative filename for "millions" case
  millions_name <- paste0(unique_indicators[i], "_millions_", Sys.Date(),  ".png")
  millions_fname <- paste(img_dir, millions_name, sep = "/")

# Check for the primary filename, if it doesn't exist, check for the "millions" version
if (file.exists(fname)) {
  knitr::include_graphics(fname)
} else if (file.exists(millions_fname)) {
  knitr::include_graphics(millions_fname)
} else {
  cat(paste0("Plot for '", ind_name, "' not found at either path."))
}
  ############not sure why it isn't finding some of the figures even though I see them there
  cat("\n\n") # Add space after each plot
}
```
